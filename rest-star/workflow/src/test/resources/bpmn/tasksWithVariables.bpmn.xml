<?xml version="1.0" encoding="UTF-8"?>
<definitions id="vacationRequest"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xsi:schemaLocation="http://schema.omg.org/spec/BPMN/2.0 ../../../../../../../../../../bpmn/src/main/resources/BPMN20.xsd"
             xmlns="http://schema.omg.org/spec/BPMN/2.0" typeLanguage="http://www.w3.org/2001/XMLSchema"
             expressionLanguage="http://www.w3.org/1999/XPath"
             targetNamespace="http://jbpm.org/example/bpmn2/vacation_request"
             xmlns:jbpm="http://jbpm.org/bpmn2">

    <process id="vacationRequestProcess" name="BPMN2 Example process using task forms">

        <startEvent id="start"/>

        <sequenceFlow id="flow1" name="fromStartToRequestVacation"
                      sourceRef="start" targetRef="requestVacation"/>

        <userTask id="requestVacation" name="Request Vacation"
                  implementation="other">
            <potentialOwner resourceRef="user" jbpm:type="group">
                <resourceAssignmentExpression>
                    <formalExpression>user</formalExpression>
                </resourceAssignmentExpression>
            </potentialOwner>
        </userTask>

        <sequenceFlow id="request-vacation"
                      name="fromRequestVacationToVerifyRequest" sourceRef="requestVacation"
                      targetRef="verifyRequest"/>

        <userTask id="verifyRequest" name="Verify Request"
                  implementation="other">
            <potentialOwner resourceRef="user" jbpm:type="group">
                <resourceAssignmentExpression>
                    <formalExpression>manager</formalExpression>
                </resourceAssignmentExpression>
            </potentialOwner>
        </userTask>

        <sequenceFlow id="ok" name="fromVerifyRequestToEnd"
                      sourceRef="verifyRequest" targetRef="sendOkMessage">
            <conditionExpression xsi:type="tFormalExpression">${verificationResult == 'OK'}</conditionExpression>
        </sequenceFlow>

        <sequenceFlow id="notOk"
                      name="fromVerifyRequestToSendRejectionMessage" sourceRef="verifyRequest"
                      targetRef="sendRejectionMessage">
            <conditionExpression xsi:type="tFormalExpression">${verificationResult == 'Not OK'}</conditionExpression>
        </sequenceFlow>

        <scriptTask id="sendRejectionMessage" name="Send rejection Message"
                    scriptLanguage="bsh">
            <script>
                <![CDATA[System.out.println("Vacation request refused!");]]>
            </script>
        </scriptTask>

        <scriptTask id="sendOkMessage" name="Send ok Message"
                    scriptLanguage="bsh">
            <script>
                <![CDATA[System.out.println("Vacation request accepted!");]]>
            </script>
        </scriptTask>

        <sequenceFlow id="flow5"
                      name="fromSendRejectionMessageToEnd" sourceRef="sendRejectionMessage"
                      targetRef="theEnd"/>

        <sequenceFlow id="flow6"
                      name="fromSendOkMessageToEnd" sourceRef="sendOkMessage"
                      targetRef="theEnd"/>

        <endEvent id="theEnd" name="End"/>


    </process>
</definitions>
